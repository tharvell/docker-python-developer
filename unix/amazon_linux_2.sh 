#/bin/sh
# This script was tested on 
# 
# NAME="Amazon Linux"
# VERSION="2"
# ID="amzn"
# ID_LIKE="centos rhel fedora"
# VERSION_ID="2"
# PRETTY_NAME="Amazon Linux 2"
# ANSI_COLOR="0;33"
# CPE_NAME="cpe:2.3:o:amazon:amazon_linux:2"
# HOME_URL="https://amazonlinux.com/"

# Remove the existing vim
yum remove vim-common.x86_64
yum remove vim-enhanced.x86_64
yum erase vim-common.x86_64 vim-enhanced.x86_64 vim-filesystem.x86_64

# Install buid dependencies 
yum install gcc
yum install ncurses-devel
yum install cmake
yum install clang
amazon-linux-extras install epel

# Install vim dependencies 
yum install -y ruby ruby-devel lua lua-devel luajit luajit-devel ctags git python python-devel python3 python3-devel tcl-devel perl perl-devel perl-ExtUtils-ParseXS perl-ExtUtils-XSpp perl-ExtUtils-CBuilder perl-ExtUtils-Embed

########################################
#
# Install vim from source 
#
########################################

cd ~

git clone https://github.com/vim/vim.git

cd vim

./configure --with-features=huge \
 		    --enable-pythoninterp=yes \
 			--enable-python3interp=yes \
 			--enable-perlinterp=yes \
 			--disable-tclinterp \
		    --enable-multibyte \
 			--enable-cscope \
 			--with-tlib=ncurses \
			--enable-fail-if-missing \
			--disable-darwin --enable-luainterp=yes \
			--enable-rubyinterp=yes --enable-terminal \
 			--enable-fontset --with-luajit --with-python3-command=python3 \
			--enable-gtk3-check

make && sudo make install

cd ~

########################################
#
# Install packages for vim 
#
########################################


mkdir -p ~/.vim/autoload ~/.vim/bundle \
    && curl -LSso ~/.vim/autoload/pathogen.vim https://tpo.pe/pathogen.vim \
    && cd ~/.vim/bundle \
    && git clone https://github.com/tpope/vim-fugitive.git \
    && git clone https://github.com/jnurmine/Zenburn.git \
    && git clone https://github.com/nvie/vim-flake8.git \ 
    && git clone https://github.com/scrooloose/nerdtree.git \
    && git clone https://github.com/vim-syntastic/syntastic.git \ 
    && git clone https://github.com/tmhedberg/SimpylFold.git \
    && git clone https://github.com/vim-scripts/indentpython.vim.git \
    && git clone https://github.com/itchyny/lightline.vim \ 
    && git clone https://github.com/Valloric/YouCompleteMe.git \
       && cd YouCompleteMe && git submodule update --init --recursive \
       && ./install.py --clang-completer \
cd ~


########################################
#
# Set up everything else  
#
########################################

mkdir ~/.zsh && curl -L git.io/antigen > ~/.zsh/antigen.zsh 

yum install tmux

sudo yum install zsh

cp docker-python-developer/config_files/.* ~

rm -rf docker-python-developer 

